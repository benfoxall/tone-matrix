function boxLayout(){function t(t){if(n=t||n){var u=d3.max(n.map(e("i"))),d=d3.max(n.map(e("j")));console.log(u,d),s.domain([0,u+1]).range([0,i]),c.domain([0,d+1]).range([0,o]);var l=s(1),f=c(1);n.forEach(function(t){t.width=l*(1-a),t.height=f*(1-a),t.x=s(t.i)+l*a*.5,t.y=c(t.j)+f*a*.5}),r(n)}}function e(t){return function(e){return e[t]}}var n,i=400,o=400,a=.2,r=function(){},s=d3.scale.linear(),c=d3.scale.linear();return t.update=function(t){return"undefined"==typeof t?r:(r=t,this)},t.width=function(t){return"undefined"==typeof t?i:(i=t,this)},t.height=function(t){return"undefined"==typeof t?o:(o=t,this)},t.padding=function(t){return"undefined"==typeof t?a:(a=t,this)},t}function Note(t,e){this.i=t,this.j=e}function schedule(){var t=1e3*duration-now()%(1e3*duration);notes.forEach(function(e,n){if(e.active){var i=cscale[e.j],o=timescale(e.i)+t/1e3;play(i,o),setTimeout(function(){item[0][n].className="item playing",setTimeout(function(){item[0][n].className=e.active?"item active":"item"},500)},1e3*o)}})}function play(t,e){var n=context.currentTime+(e||0),i=context.createOscillator();i.frequency.value=t;var o=context.createGain();o.gain.value=0,o.gain.exponentialRampToValueAtTime(.2,n+.2),o.gain.linearRampToValueAtTime(0,n+.5),i.connect(o),o.connect(context.destination),i.start(n),i.stop(n+1)}function showTimings(){b.padding(.3)(timers)}function showNotes(){b.padding(0)(notes)}function showSingle(){b.padding(0)([{i:0,j:0}])}function fitWindow(){b.width(window.innerWidth).height(window.innerHeight)()}var el=d3.select("body").append("div").attr("class","grid"),b=boxLayout().width(window.innerWidth).height(window.innerHeight).padding(0);Note.prototype.handle=function(t){this.active=!this.active,t.className=this.active?"item active":"item"};for(var timesteps=16,notes=[],i=0;timesteps>i;i++)for(var j=0;7>j;j++)notes.push(new Note(i,j));var timeButtons=[{i:0,j:0,handle:function(){console.log("asdfas")}},{i:1,j:0},{i:2,j:0},{i:3,j:0}],item=el.selectAll(".item").data(notes);b.update(function(t){function e(t){d3.event.stopPropagation(),d3.event.preventDefault(),console.log(this),t.handle&&t.handle(this)}item=item.data(t),item.enter().append("div").style("width",0).style("height",0).attr("class","item").on("touchstart",e).on("mousedown",e),item.style("transform",function(t){return"translate("+t.x+"px, "+t.y+"px)"}).transition().delay(function(t,e){return 200+10*e}).style("width",function(t){return t.width+"px"}).style("height",function(t){return t.height+"px"}),item.exit().transition().style("width",0).remove(),item.attr("class",function(t){return t.active?"item active":"item"})}),b(notes);var now=function(){var t=0;return reqwest("http://js-time.herokuapp.com/").then(function(e){t=Date.now()-parseInt(e),console.log(t)}),function(){return Date.now()-t}}(),duration=2,timescale=d3.scale.linear().domain([0,timesteps]).range([0,duration]),cscale=[880,783.99,698.46,659.26,587.33,523.25,493.88];setInterval(schedule,1e3*duration),context="undefined"!=typeof webkitAudioContext?new webkitAudioContext:new AudioContext,notes.reduce(function(t,e){return t.indexOf(e.i+"_"+e.j)>-1&&(e.active=!0),t},["0_3","4_4","8_5","10_6","12_7","14_9"]);var teardowns=[],timers=[{i:0,j:0,handle:function(){console.log("set timer one")}},{i:1,j:0,handle:function(){console.log("set timer two")}},{i:2,j:0,handle:function(){console.log("set timer three")}},{i:3,j:0,handle:function(){console.log("set timer four")}}];fitWindow(),d3.select(window).on("resize",fitWindow);
//# sourceMappingURL=all.js.map