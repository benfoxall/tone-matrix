{"version":3,"sources":["d3.extensions.js","main.js"],"names":["boxLayout","layout","_data","data","x_max","d3","max","map","prop","y_max","console","log","x","domain","range","width","y","height","w","h","forEach","d","padding","i","j","update","p","obj","scale","linear","_","this","Note","schedule","off","duration","now","notes","n","active","f","cscale","t","timescale","play","setTimeout","item","className","context","currentTime","oscillator","createOscillator","frequency","value","gainNode","createGain","gain","exponentialRampToValueAtTime","linearRampToValueAtTime","connect","destination","start","stop","showTimings","b","timers","showNotes","showSingle","fitWindow","window","innerWidth","innerHeight","el","select","append","attr","prototype","handle","element","timesteps","push","timeButtons","selectAll","handler","event","stopPropagation","preventDefault","enter","style","on","transition","delay","exit","remove","serverOffset","reqwest","then","Date","parseInt","setInterval","webkitAudioContext","AudioContext","reduce","list","note","indexOf","teardowns"],"mappings":"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","file":"all.js","sourcesContent":["\nfunction boxLayout(){\n  var width = 400,\n      height = 400,\n      padding = .2,\n      update = function(){},\n      data;\n\n  var x = d3.scale.linear(),\n      y = d3.scale.linear();\n\n  function layout(_data){\n    if(!(data = _data || data)) return;\n\n    var x_max = d3.max(data.map(prop('i')));\n    var y_max = d3.max(data.map(prop('j')));\n\n    console.log(x_max, y_max);\n\n    x\n      .domain([0,x_max+1])\n      .range([0,width]);\n\n    y\n      .domain([0,y_max+1])\n      .range([0,height]);\n\n    var w = x(1), h = y(1);\n\n    data.forEach(function(d){\n      d.width  = w*(1-padding);\n      d.height = h*(1-padding);\n      d.x = x(d.i)+(w*padding*.5);\n      d.y = y(d.j)+(h*padding*.5);\n    });\n\n    update(data);\n  }\n\n layout.update = function(_){\n    return (typeof(_) === 'undefined') ? \n      update : ((update = _), this);\n  }\n\n  layout.width = function(_){\n    return (typeof(_) === 'undefined') ? \n      width : ((width = _), this);\n  }\n\n  layout.height = function(_){\n    return (typeof(_) === 'undefined') ? \n      height : ((height = _), this);\n  }\n\n  layout.padding = function(_){\n    return (typeof(_) === 'undefined') ? \n      padding : ((padding = _), this);\n  }\n\n  return layout\n\n  function prop(p){\n    return function(obj){\n      return obj[p]\n    }\n  }\n}\n","var el = d3.select('body')\n  .append('div')\n  .attr('class', 'grid')\n\nvar b = boxLayout()\n  .width(window.innerWidth)\n  .height(window.innerHeight)\n  .padding(0);\n\n\nfunction Note(i, j){\n  this.i = i;\n  this.j = j;\n}\n\nNote.prototype.handle = function(element) {\n  this.active = !this.active;\n\n  // shortcut the active classes\n  element.className = this.active ? 'item active' :'item';\n};\n\n\nvar timesteps = 16,\n    notes = [];\n\nfor(var i = 0; i < timesteps; i++){\n  for(var j = 0; j < 7; j++){\n    notes.push(new Note(i,j))\n  }\n}\n\n// var notes2 = [];\n\n// for(var i = 0; i < 5; i++){\n//   for(var j = 0; j < 5; j++){\n//     notes2.push(new Note(i,j))\n//   }\n// }\n\nvar timeButtons = [\n  {i: 0, j:0, handle: function(){\n    console.log(\"asdfas\")\n  }},{i: 1, j:0},{i: 2, j:0},{i: 3, j:0}\n]\n\n\n\nvar item = el.selectAll('.item')\n  .data(notes);\n\nb.update(function(data){\n\n  item = item.data(data)\n\n  item\n    .enter()\n    .append('div')\n    .style('width', 0)\n    .style('height', 0)\n    .attr('class', 'item')\n    .on('touchstart', handler)\n    .on('mousedown', handler)\n    // .style('transition-delay', function(d){return ((d.j+d.i) / 70) + 's'});\n    // .style('transform', 'translate(0,0)')\n\n\n\n  item\n    .style('transform', function(d){return 'translate('+d.x+'px, '+d.y+'px)'})\n    .transition()\n    .delay(function(d,i){return 200+(i*10)})\n    // .transition()\n    // .delay(function(d,i){return i*10})\n    .style('width', function(d){return d.width + 'px'})\n    .style('height', function(d){return d.height + 'px'})\n\n  item\n    .exit()\n    .transition()\n    .style('width', 0)\n    .remove();\n\nitem.attr('class', function(d){return d.active ? 'item active' :'item'})\n\n  function handler(d){  \n    // stop touches from firing mouse/click event\n    d3.event.stopPropagation();\n    d3.event.preventDefault();\n    console.log(this)\n\n    d.handle && d.handle(this)\n  }\n\n})\n\nb(notes);\n\n// this could be any timestamp, or tween of timestamps\n// or whatever\nvar now = (function(){\n  var serverOffset = 0;\n  reqwest('http://js-time.herokuapp.com/')\n  .then(function(d){ \n    serverOffset = Date.now() - parseInt(d);\n    console.log(serverOffset)\n  })\n\n  return function now(){\n    return Date.now() - serverOffset;\n  }\n})();\n\n\nvar duration = 2;\nvar timescale = d3.scale.linear()\n  .domain([0, timesteps])\n  .range([0,duration])\n\nvar cscale = [880, 783.99, 698.46, 659.26, 587.33, 523.25, 493.88];\n\nfunction schedule(){\n\n  var off = (duration*1000) - (now() % (duration*1000));\n  // console.log(off);\n\n\n  notes.forEach(function(n,i){\n    if(n.active){\n      var f = cscale[n.j], // 1200 - (n.j*100),\n          t = timescale(n.i) + (off/1000);\n      play(f, t);\n      setTimeout(function(){\n        item[0][i].className = 'item playing'\n        setTimeout(function(){\n          item[0][i].className = n.active ? 'item active' : 'item'\n        }, 500)\n      }, t*1000)\n    }\n  });\n}\n\nsetInterval(schedule, duration*1000)\n\n\ncontext =\n  typeof(webkitAudioContext) !== 'undefined' ? \n     new webkitAudioContext() :\n     new AudioContext();\n\nfunction play(f, off){\n\n  var now = context.currentTime + (off||0);\n\n  var oscillator = context.createOscillator();\n\n  oscillator.frequency.value = f;\n  // Create sound source  \n\n  var gainNode = context.createGain();\n  gainNode.gain.value = 0;\n  gainNode.gain.exponentialRampToValueAtTime(0.2, now+0.2);\n  gainNode.gain.linearRampToValueAtTime(0, now+0.5);\n  oscillator.connect(gainNode);\n  gainNode.connect(context.destination);\n\n  // gainNode.start(0)\n  oscillator.start(now);\n  oscillator.stop(now+1);\n\n}\n\n\nnotes.reduce(function(list, note){\n  if(list.indexOf(note.i + '_' + note.j) > -1){\n    note.active = true;\n  }\n  return list;\n}, [\"0_3\", \"4_4\", \"8_5\", \"10_6\", \"12_7\", \"14_9\"])\n\n\n\n// ting\n// var tingBuffer;\n\n// var xhr = new XMLHttpRequest();\n// xhr.open('GET', '_ting.mp3', true);\n// xhr.responseType = 'arraybuffer';\n\n// // Decode asynchronously\n// xhr.onload = function() {\n//   context.decodeAudioData(xhr.response, function(buffer) {\n//     tingBuffer = buffer;\n//     // if(!firstLoaded) firstLoaded = name;\n//   }, function(e){\n//       console.log(\"an error occured requesting \", url, e)\n//   });\n// }\n// xhr.send();\n\n\n\n/*\nvar filter = context.createBiquadFilter();\nfilter.type = \"lowshelf\";\nfilter.frequency.value = 1000;\nfilter.gain.value = 25;\nfilter.connect(context.destination);\n\nfunction play(f, off){\n\n  if(!tingBuffer) return;\n\n  var now = context.currentTime + (off||0);\n\n  var rate =  f/200\n\n  var source = context.createBufferSource();\n      source.buffer = tingBuffer;\n      source.playbackRate.value = rate;\n      // source.connect(context.destination);\n      source.connect(filter)\n      source.start(now);\n\n}\n*/\n\nvar teardowns = [];\n\n\nvar timers = [ \n  {\n    i: 0, j:0,\n    handle: function(){\n      console.log(\"set timer one\")\n    }\n  },\n  {\n    i: 1, j:0,\n    handle: function(){\n      console.log(\"set timer two\")\n    }\n  },\n  {\n    i: 2, j:0,\n    handle: function(){\n      console.log(\"set timer three\")\n    }\n  },\n  {\n    i: 3, j:0,\n    handle: function(){\n      console.log(\"set timer four\")\n    }\n  }\n  \n]\n\nfunction showTimings(){\n  b.padding(0.3)(timers)\n}\n\nfunction showNotes(){\n  b.padding(0)(notes)\n}\n\nfunction showSingle(){\n  b.padding(0)([{i:0,j:0}])\n}\n\n\n\n\nfunction fitWindow(){\n  b\n    .width(window.innerWidth)\n    .height(window.innerHeight)\n  ()\n}\n\nfitWindow();\n\nd3.select(window).on('resize', fitWindow)\n"],"sourceRoot":"/source/"}