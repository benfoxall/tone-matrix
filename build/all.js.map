{"version":3,"sources":["d3.extensions.js","main.js"],"names":["boxLayout","layout","_data","data","x_max","d3","max","map","prop","y_max","console","log","x","domain","range","width","y","height","w","h","forEach","d","padding","i","j","update","p","obj","scale","linear","_","this","Note","now","Date","schedule","off","duration","notes","n","active","f","t","timescale","play","setTimeout","item","className","context","currentTime","oscillator","createOscillator","frequency","value","gainNode","createGain","gain","exponentialRampToValueAtTime","linearRampToValueAtTime","connect","destination","start","stop","fitWindow","b","window","innerWidth","innerHeight","el","select","append","attr","prototype","handle","timesteps","push","selectAll","handler","enter","style","on","exit","transition","remove","setInterval","webkitAudioContext","AudioContext","reduce","list","note","indexOf"],"mappings":"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","file":"all.js","sourcesContent":["\nfunction boxLayout(){\n  var width = 400,\n      height = 400,\n      padding = .2,\n      update = function(){},\n      data;\n\n  var x = d3.scale.linear(),\n      y = d3.scale.linear();\n\n  function layout(_data){\n    if(!(data = _data || data)) return;\n\n    var x_max = d3.max(data.map(prop('i')));\n    var y_max = d3.max(data.map(prop('j')));\n\n    console.log(x_max, y_max);\n\n    x\n      .domain([0,x_max+1])\n      .range([0,width]);\n\n    y\n      .domain([0,y_max+1])\n      .range([0,height]);\n\n    var w = x(1), h = y(1);\n\n    data.forEach(function(d){\n      d.width  = w*(1-padding);\n      d.height = h*(1-padding);\n      d.x = x(d.i)+(w*padding*.5);\n      d.y = y(d.j)+(h*padding*.5);\n    });\n\n    update(data);\n  }\n\n layout.update = function(_){\n    return (typeof(_) === 'undefined') ? \n      update : ((update = _), this);\n  }\n\n  layout.width = function(_){\n    return (typeof(_) === 'undefined') ? \n      width : ((width = _), this);\n  }\n\n  layout.height = function(_){\n    return (typeof(_) === 'undefined') ? \n      height : ((height = _), this);\n  }\n\n  layout.padding = function(_){\n    return (typeof(_) === 'undefined') ? \n      padding : ((padding = _), this);\n  }\n\n  return layout\n\n  function prop(p){\n    return function(obj){\n      return obj[p]\n    }\n  }\n}\n","var el = d3.select('body')\n  .append('div')\n  .attr('class', 'grid')\n\nvar b = boxLayout()\n  .width(window.innerWidth)\n  .height(window.innerHeight);\n\n\nfunction Note(i, j){\n  this.i = i;\n  this.j = j;\n}\n\nNote.prototype.handle = function() {  \n  this.active = !this.active;\n  item.attr('class', function(d){return d.active ? 'item active' :'item'})\n};\n\n\nvar timesteps = 16,\n    notes = [];\n\nfor(var i = 0; i < timesteps; i++){\n  for(var j = 0; j < 10; j++){\n    notes.push(new Note(i,j))\n  }\n}\n\nvar item = el.selectAll('.item')\n  .data(notes);\n\nb.update(function(data){\n\n  item = item.data(data)\n\n  item\n    .enter()\n    .append('div')\n    .style('width', 0)\n    .style('height', 0)\n    .attr('class', 'item')\n    .on('touchstart', handler)\n    .on('mousedown', handler)\n    // .style('transition-delay', function(d){return ((d.j+d.i) / 70) + 's'});\n\n  item\n    .exit()\n    .transition()\n    .style('width', 0)\n    .remove();\n\n  item\n    .style('transform', function(d){return 'translate('+d.x+'px, '+d.y+'px)'})\n    .style('width', function(d){return d.width + 'px'})\n    .style('height', function(d){return d.height + 'px'})\n\n  function handler(d){\n    d.handle && d.handle()\n  }\n\n})\n\nb(notes);\n\n// this could be any timestamp, or tween of timestamps\n// or whatever\nfunction now(){\n  return Date.now();\n}\n\nvar duration = 2;\nvar timescale = d3.scale.linear()\n  .domain([0, timesteps])\n  .range([0,duration])\n\nfunction schedule(){\n\n  var off = (duration*1000) - (now() % (duration*1000));\n  // console.log(off);\n\n\n  notes.forEach(function(n,i){\n    if(n.active){\n      var f = 1200 - (n.j*100),\n          t = timescale(n.i) + (off/1000);\n      play(f, t);\n      setTimeout(function(){\n        item[0][i].className = 'item playing'\n        setTimeout(function(){\n          item[0][i].className = n.active ? 'item active' : 'item'\n        }, 500)\n      }, t*1000)\n    }\n  });\n}\n\nsetInterval(schedule, duration*1000)\n\n\ncontext =\n  typeof(webkitAudioContext) !== 'undefined' ? \n     new webkitAudioContext() :\n     new AudioContext();\n\nfunction play(f, off){\n\n  var now = context.currentTime + (off||0);\n\n  var oscillator = context.createOscillator();\n\n  oscillator.frequency.value = f;\n  // Create sound source  \n\n  var gainNode = context.createGain();\n  gainNode.gain.value = 0;\n  gainNode.gain.exponentialRampToValueAtTime(0.01, now+0.2);\n  gainNode.gain.linearRampToValueAtTime(0, now+0.5);\n  oscillator.connect(gainNode);\n  gainNode.connect(context.destination);\n\n  // gainNode.start(0)\n  oscillator.start(now);\n  oscillator.stop(now+1);\n\n}\n\n//19.55 -> 20:14\n\n\nnotes.reduce(function(list, note){\n  if(list.indexOf(note.i + '_' + note.j) > -1){\n    note.active = true;\n  }\n  return list;\n}, [\"0_3\", \"4_4\", \"8_5\", \"10_6\", \"12_7\", \"14_9\"])\n\n\n\n\n// ting\n// var tingBuffer;\n\n// var xhr = new XMLHttpRequest();\n// xhr.open('GET', '_ting.mp3', true);\n// xhr.responseType = 'arraybuffer';\n\n// // Decode asynchronously\n// xhr.onload = function() {\n//   context.decodeAudioData(xhr.response, function(buffer) {\n//     tingBuffer = buffer;\n//     // if(!firstLoaded) firstLoaded = name;\n//   }, function(e){\n//       console.log(\"an error occured requesting \", url, e)\n//   });\n// }\n// xhr.send();\n\n\n\n/*\nvar filter = context.createBiquadFilter();\nfilter.type = \"lowshelf\";\nfilter.frequency.value = 1000;\nfilter.gain.value = 25;\nfilter.connect(context.destination);\n\nfunction play(f, off){\n\n  if(!tingBuffer) return;\n\n  var now = context.currentTime + (off||0);\n\n  var rate =  f/200\n\n  var source = context.createBufferSource();\n      source.buffer = tingBuffer;\n      source.playbackRate.value = rate;\n      // source.connect(context.destination);\n      source.connect(filter)\n      source.start(now);\n\n}\n*/\n\n\nfunction fitWindow(){\n\n  b.width(window.innerWidth);\n  b.height(window.innerHeight);\n  b();\n}\n\nfitWindow();\n\nd3.select(window).on('resize', fitWindow)\n"],"sourceRoot":"/source/"}